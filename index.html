<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Calculator</title>
  <style>
    :root{
      --bg:#0f1724; /* dark blue */
      --card:#0b1220;
      --accent:#7c3aed;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#071029 0%,#081229 50%, #07112a 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      color:#e6eef6;padding:24px
    }
    .calculator{
      width:360px;max-width:100%;background:linear-gradient(180deg,var(--card), #071227);border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(2,6,23,0.7);
    }
    .screen{
      background:var(--glass);padding:18px;border-radius:12px;display:flex;flex-direction:column;gap:6px;margin-bottom:12px;min-height:92px
    }
    .history{font-size:13px;color:var(--muted);text-align:right;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
    .output{font-size:28px;font-weight:600;text-align:right}
    .buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button{
      padding:18px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:inherit;font-size:18px;font-weight:600;cursor:pointer;backdrop-filter:blur(4px);transition:all .14s ease;box-shadow:0 4px 10px rgba(2,6,23,0.4);
    }
    button:active{transform:translateY(2px) scale(.998);}
    .btn-operator{background:linear-gradient(180deg,rgba(124,58,237,0.18),rgba(124,58,237,0.08));}
    .btn-equals{grid-column:span 2;background:var(--accent);color:white}
    .btn-wide{grid-column:span 2}
    .btn-danger{background:linear-gradient(180deg,rgba(239,68,68,0.12),rgba(239,68,68,0.06));}
    .kbd-hint{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
    @media (max-width:420px){button{padding:14px;font-size:16px}}
  </style>
</head>
<body>
  <div class="calculator" role="application" aria-label="Calculator">
    <div class="screen">
      <div class="history" id="history">&nbsp;</div>
      <div class="output" id="output">0</div>
    </div>
    <div class="buttons" id="buttons">
      <button class="btn-danger" data-action="clear">C</button>
      <button data-action="back">⌫</button>
      <button data-action="percent">%</button>
      <button class="btn-operator" data-value="/">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="btn-operator" data-value="*">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="btn-operator" data-value="-">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="btn-operator" data-value="+">+</button>

      <button class="btn-wide" data-value="0">0</button>
      <button data-value=".">.</button>
      <button class="btn-equals" data-action="equals">=</button>
    </div>
    <div class="kbd-hint">Keyboard: numbers, + - * /, Enter = evaluate, Backspace = delete</div>
  </div>

  <script>
    (function(){
      const output = document.getElementById('output');
      const history = document.getElementById('history');
      let expr = '';

      function safeDisplay(v){
        output.textContent = (v === '' ? '0' : v);
      }

      function append(char){
        // prevent leading zeros like 00
        if(expr === '0' && /[0-9]/.test(char)) expr = char;
        else expr += char;
        safeDisplay(expr);
      }

      function clearAll(){ expr=''; history.textContent=''; safeDisplay(''); }
      function back(){ expr = expr.slice(0,-1); safeDisplay(expr); }

      function evaluateExpression(){
        if(!expr) return;
        // sanitize: allow only digits, operators, dot, parentheses and percent
        if(!/^[0-9.()+\-*/%\s]+$/.test(expr)){
          history.textContent = 'Invalid input'; output.textContent='Error'; expr='';
          return;
        }
        try{
          // handle percent: replace 'number%' with (number/100)
          const sanitized = expr.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          // use Function instead of eval
          const result = Function('return '+sanitized)();
          history.textContent = expr + ' =';
          expr = String(result);
          safeDisplay(expr);
        }catch(e){ history.textContent='Error'; output.textContent='Error'; expr=''; }
      }

      document.getElementById('buttons').addEventListener('click', (e)=>{
        const b = e.target.closest('button'); if(!b) return;
        const val = b.getAttribute('data-value');
        const action = b.getAttribute('data-action');
        if(action === 'clear') clearAll();
        else if(action === 'back') back();
        else if(action === 'equals') evaluateExpression();
        else if(action === 'percent') append('%');
        else if(val) append(val);
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key >= '0' && e.key <= '9') { append(e.key); e.preventDefault(); }
        else if(e.key === '.') { append('.'); e.preventDefault(); }
        else if(['+','-','/','*','(',')'].includes(e.key)){ append(e.key); e.preventDefault(); }
        else if(e.key === 'Enter' || e.key === '='){ evaluateExpression(); e.preventDefault(); }
        else if(e.key === 'Backspace'){ back(); e.preventDefault(); }
        else if(e.key === '%'){ append('%'); e.preventDefault(); }
        else if(e.key.toLowerCase()==='c' && (e.ctrlKey||e.metaKey)){ clearAll(); }
      });

      // load
      safeDisplay('');
    })();
  </script>
</body>
</html>
